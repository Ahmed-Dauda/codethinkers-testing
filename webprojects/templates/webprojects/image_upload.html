<!-- templates/webprojects/image_upload.html -->
{% extends "webprojects/base_editor.html" %}
{% load static %}

{% block content %}
<h2>Upload an Image</h2>

<div id="drop-area" style="border: 2px dashed #ccc; padding: 30px; text-align: center;">
  <p>Drag & Drop your image here</p>
  <p>or</p>
  <input type="file" id="fileElem" accept="image/*" style="display:none">
  <button id="fileSelect">Browse</button>
</div>

<form id="uploadForm" method="POST" enctype="multipart/form-data" style="display:none;">
  {% csrf_token %}
  <input type="text" name="name" id="imageName">
  <input type="file" name="image" id="imageInput">
</form>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileElem = document.getElementById('fileElem');
  const fileSelect = document.getElementById('fileSelect');
  const uploadForm = document.getElementById('uploadForm');
  const imageInput = document.getElementById('imageInput');
  const imageName = document.getElementById('imageName');

  fileSelect.addEventListener('click', () => fileElem.click());

  fileElem.addEventListener('change', handleFiles);
  dropArea.addEventListener('dragover', e => {
    e.preventDefault();
    dropArea.style.background = '#eee';
  });

  dropArea.addEventListener('dragleave', () => dropArea.style.background = '');
  dropArea.addEventListener('drop', e => {
    e.preventDefault();
    dropArea.style.background = '';
    handleFiles(e);
  });

  function handleFiles(e) {
    const file = e.target.files ? e.target.files[0] : e.dataTransfer.files[0];
    if (file) {
      imageName.value = file.name;
      imageInput.files = e.dataTransfer ? e.dataTransfer.files : e.target.files;
      uploadForm.submit();
    }
  }
</script>
{% endblock %}
