{% extends 'sms/dashboard/base.html' %}

{% load hitcount_tags %}
{% load cloudinary %}
{% load embed_video_tags %}

{% block title %} Course Overall Scores Detail View {% endblock %}

  {% block content %} 
    <!-- prism.css and prism.js -->
    <link rel="stylesheet" type="text/css" href="/static/sms/prism.css">
    <script src="/static/sms/prism.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <style>



img, .videoWrapper{
width: 100%;
}

.d-flex{
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
}

.d-flex >*{
    flex: 1 1 auto;
    margin: 0px;
} 

table.display {
margin: 0 auto;
width: 100%;
clear: both;
border-collapse: collapse;
table-layout: fixed; // ***********add this
}


/* video controller css  */

.video-container {
  display: flex;
  justify-content: center;
  align-items: center;
 
}

.video-wrapper {
  margin-left: 10px;
  margin-right: 10px;
}

.video-wrapper iframe {
  width: 350px;
  height: 220px;
}
@media (min-width: 768px) { /* Adjust the breakpoint as per your needs */
  .video-wrapper iframe {
    width: 800px;
    height: 450px;
  }
}

/*  end video controller css  */

/* transcript */


  .dataTables_wrapper  {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* .dataTables_wrapper .bottom {
        width: 100%;
        text-align: center;
    } */
    .dataTables_filter { 
        display: none; 
        float: left;
    }
    .dataTables_length {
        display: none;
        float: left;
    } 


.makecompleted{
    display: flex;
    flex-wrap: wrap;
    padding-left: 20px;
}

.sidebar{
    
    flex-wrap: wrap;

}
/* Hide the content on mobile view */
@media (max-width: 767px) {
    .hide-on-mobile {
        display: none;
       
    }
}

/* herozontal scroll on mobile view */

</style>

<style>

.app-container {
  position: relative;
}

.banner-overlay {
    position: absolute;
    width: 100%;
    height: 110px;
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.7) 99%, rgb(0, 0, 0, 1));
    opacity: 0;
    top: 0px;
    left: 0;
}

.watch-overlay {
    position: absolute;
    width: 200px;
    height: 170px;
    margin: 380px;
    margin-left: 660px;
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(33, 2, 2, 0.7) 99%, rgb(0, 0, 0, 1));
    opacity: 0;
    top: 0px;
    left: 0;
}


@media (max-width: 768px) {
    .watch-overlay {
        /* Adjust the styles for mobile view */
        width: 100px; /* Example: Make the overlay full width */
        height: 150px; /* Adjust the height as needed for responsiveness */
        margin: 150px; /* Remove margin */
        margin-left: 260px; /* Remove margin-left */
        background-image: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(33, 2, 2, 0.7) 99%, rgb(0, 0, 0, 1)); /* Keep the same background */
        top: 0;
        left: 0;
        opacity: 0;
    }
}

/* herozontal scroll  */
.video-list-container {
  display: flex;
  position: relative;
}

.video-container {
  flex: 1;
}

.video-wrapper {
  background: #000000;
  position: relative;
  margin-right: 20px; /* Adjust spacing between video and list */
}

.scrollable-list {
padding-left: 0px;
  position: fixed;
  top: 0;
  bottom: 0;
  overflow-y: auto;
  max-height: 80%;
  width: 250px; /* Adjust the width as needed */
  background-color: #f0f0f0; /* Optional: Add a background color to the list container */
  border-left: 1px solid #ccc; /* Optional: Add a border to visually separate the video and list */
}

.scrollable-list ul {
 
  list-style: none;
  padding: 0;
  margin: 0;
}

.scrollable-list ul li {

  margin-bottom: 10px; /* Adjust spacing between list items */
  padding: 5px; /* Optional: Add padding to list items for better readability */
}

.text{
    padding-left: 300px; 
    padding-right: 100px;
}
/* Media query for mobile devices */
@media (max-width: 768px) {
    .text {
        padding-left: 5px; /* Adjust padding-left for mobile view */
    }
}

/* Media query for tablet devices */
@media (min-width: 768px) and (max-width: 1024px) {
    .text {
        padding-left: 5px; /* Adjust padding-left for tablet view */
    }
}
/* Default styles */
.scrollable-list {
  display: block; /* Show the scrollable list by default */
}

/* Media query for mobile devices */
@media (max-width: 768px) {
  .scrollable-list {
    display: none; /* Hide the scrollable list on mobile devices */
  }
}

/* Media query for tablet devices */
@media (min-width: 768px) and (max-width: 1024px) {
  .scrollable-list {
    display: none; /* Hide the scrollable list on tablet devices */
  }
}
/* end of scrollable-list */

</style>


<div style="text-align: center;">
    <button class="btn"><a href="https://wa.me/23409031568177">Contact Us For Personal Tutoring</a></button>
  </div>
                    
 <!-- <button class="btn "><a  href="https://wa.me/23409031568177"> Contact Us For Personal Tutoring </a>  </button>  -->



<!-- embed for youtube video https://www.youtube.com/watch?v=NlOF03DUoWc -->
<!-- <div class="app-container">
    <iframe width="560" height="315" src="http://www.youtube.com/embed/NlOF03DUoWc" frameborder="0" allowfullscreen></iframe>
  
    <div class="banner-overlay">
    </div>
</div> -->


<table  id="example" class="datatable-wide display card-body"  style="width:100%;">
    
    <thead class="">
        <tr>
            <th >

                <h6 style="flex-wrap: wrap;" class="d-flex">
                   
                    <!-- <a href="{% url 'student:take-exam' %}">Take Exam</a> -->
                    <p class="">{{c}} Modules </p> 
                    <!-- <p>{{ hitcount.total_hits }}  <i class="fas fa-eye"></i></p> -->
                    <a class="" href="{% url 'sms:feedbackformview' %}">                
                        <i class="fas fa-bell fa-fw"></i>
                        <span>Feedback</span></a>
                </h6>
            </th>
         
        </tr>
    </thead>
    <tbody>
        {% for topic in topics %}
        <tr>
       
            <td class="text-center">
                <div style="" class="text">
                    <br> 
                    {% if topic.img_topic %}
                        <img class="img-box" src="{{topic.img_topic.url}}" height="500px" width="100%" alt="topics image">
                    {% else %}
                    {% endif %}
                    <!-- Add the video player -->
                    {% if topic.video %}
                      
                    <!-- <div class="video-container">
                        <div id="myVideo" class="video-wrapper"  sandbox="allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation" style=" background:#000000; bottom: 61px; position: relative;">
                            {% video topic.video|safe class="ratio ratio-16x9" %}
                        </div>
                       
                    </div> -->



                   <div class="video-container app-container" >
                        <div  id="myVideo" class="video-wrapper app-container" sandbox="allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation" style="background: #000000; bottom: 61px; position: relative;">
         
                          <br> <br>
                          <iframe
                            src="{{ topic.video }}"
                            frameborder="0"
                            modestbranding="1"
                            rel="0"
                            showinfo="0"
                            controls="0"
                            disablekb="1"
                            >
                          </iframe>

                          <div class="banner-overlay">
                        </div>

                        <div class="watch-overlay">
                        </div>

                        </div>
                      </div>
                    
                    
                    {% endif %}
                    <!-- {% if topic.video %}
                        <div style="margin: -40px;" class="video-list-container">
                        <div class="video-container">
                            <div id="myVideo" class="video-wrapper" sandbox="allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation">
                            <iframe src="{{ topic.video }}" frameborder="0" modestbranding="1" rel="0" showinfo="0" controls="0" disablekb="1"></iframe>
                            </div>
                        </div>
                        
                        </div>
                        {% endif %} -->

                        
                    <!-- {% if topic.video %}
                      
                   <div  class="video-container app-container" >
                        <div  id="myVideo" class="video-wrapper app-container" sandbox="allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation" style="background: #000000; bottom: 61px; position: relative;">
         
                          <br> <br>
                          <iframe
                            src="{{ topic.video }}"
                            frameborder="0"
                            modestbranding="1"
                            rel="0"
                            showinfo="0"
                            controls="0"
                            disablekb="1"
                            >
                          </iframe>

                          <div class="banner-overlay">
                        </div>

                        <div class="watch-overlay">
                        </div>

                        </div>
                      </div>
                    
                    
                    {% endif %} -->
               
                    <div style="text-align: left;" class=" code-block">
                        <h4 style="color: black;">{{topic.title|title|safe}}</h4>
                        <small style="color: black;">
                            created: {{topic.created|timesince}} <br> last updated: {{topic.updated}}
                        </small> <br>
                        <hr>
                        
                        {% if topic.desc %}
                            <label style="max-width: 100%; overflow-x: hidden;" data-label="my-label-button" class="language-markup line-numbers copy-to-clipboard-button body-text text-left">{{topic.desc|safe}}</label> <br>
                            {% for t in topicsa %}
                            {% if topic.title == t.course_name.title %}
                            <button type="button" class="btn btn- text-white "> <a style="border: 2px solid black;" class="" href="{% url 'quiz:start-exam' t.id %}">Assess Your Knowledge </a></button>  <br> <br> <br>
                            <!-- <button type="button" class="btn btn- text-white "> <a style="border: 2px solid black;" class="" href="{% url 'quiz:start-exam' t.id %}">Assess Your Knowledge {{t.course_name.title}}</a></button>     -->
                            {% endif %}
                            {% endfor %}
                            {% if topic.topics_url %}
                            <p>Join Community: {{topic.topics_url|urlizetrunc:15}}</p><br>
                            {% endif %}
                        {% else %}
                            <label data-label="my-label-button" class="language-markup line-numbers copy-to-clipboard-button body-text text-left">{{topic.coursedesc|safe}}</label>
                        {% endif %}
                    </div>
                    <div style="marin-left: 60%;" >
                        
                            <button id="complete-button-{{ topic.id }} " onclick="markTopicCompleted({{ topic.id }})">Mark as Completed</button>
                            <span id="tick-icon-{{ topic.id }}" class="{% if topic.id in completed_topic_ids %}visible{% else %}d-none{% endif %}">
                              <i style="color: green;" class="fas fa-check-circle"></i>
                            </span>
                    </div>
                    <br>

                    {% if forloop.last %}
                        <h4 style="color: green;text-align:center">Congratulations! You have completed this course</h4> <br>
                        <h3 class="card text-center text-danger"><a href="{% url 'student:take-exam' %}">Take Exam</a></h3>
                    {% else %}
                        <p data-label="my-label-button" class="line-numbers copy-to-clipboard-button" style="font-size: 20px;"></p>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% empty %}
            <h3 class="card text-center text-danger">No Courses Categories Yet. CHECK LATER</h3>
        {% endfor %}
        <hr>
        
    </tbody>
    
 
</table>

<!-- {% if completed_topic_ids %}
<div id="content-container" class="makecompleted hide-on-mobile">
    {% for topic in topics %}
        <div class="bg-white topic-item" style="border: 2px solid black; margin: 5px;">
            <span id="tick-icon-{{ topic.id }}" class="{% if topic.id in completed_topic_ids %}visible{% else %}d-none{% endif %}">
                <i style="color: green;" class="fas fa-check-circle"></i>
            </span>
            <span class="">{{ topic.title }}</span>
        </div>
    {% endfor %}
</div>

{% endif %} -->


<div style="" class="scrollable-list">
    <div class="close-button">&times;</div>
    <ul>

        <!-- Add more content here -->
        <br><br>
    {% if completed_topic_ids %}
    <h3 class="text-center">Course progress</h3>
    <div style="padding: 50px;padding-right: 20px;" id="content-container" class="makecomleted hide-on-mobile">
        {% for topic in topics %}
            <div class="bg-white topic-item" style="border: 2px solid black; margin: 5px;">
                <span id="tick-icon-{{ topic.id }}" class="{% if topic.id in completed_topic_ids %}visible{% else %}d-none{% endif %}">
                    <i style="color: green;" class="fas fa-check-circle"></i>
                </span>
                <span class="">{{ topic.title }}</span>
                <!-- <a href="{% url 'sms:topicslistview' topic.id %}">{{ topic.title }}</a> -->
            </div>
        {% endfor %}
    </div>
    <!-- Add more content here -->
    {% endif %}
    

    <!-- Add more list items as needed -->
    </ul>
</div>



        
<!-- page refresh  -->
<script>
    function reloadContent() {
        $.ajax({
            url: window.location.href,  // Reload the current page
            type: 'GET',
            success: function(data) {
                // Replace the content of a specific element with the reloaded content
                $('#content-container').html($(data).find('#content-container').html());
            },
            error: function(error) {
                console.error('Error reloading content:', error);
            }
        });
    }
    
    // Example: Reload content every 10 seconds
   
    //  setInterval(reloadContent, 600000);

    </script>
    <!-- end of  -->

    
<!-- make completed javascrpts -->
<script>
    function markTopicCompleted(topicId) {
      $.ajax({
        type: "POST",
        url: "/mark_topic_completed/",
        data: {
          'topic_id': topicId,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(data) {
          $('#complete-button-' + topicId).addClass('d-none');  // Hide the button
          $('#tick-icon-' + topicId).removeClass('d-none');    // Show the tick icon
          $('#topic-status-' + topicId).text('Completed');     // Change the status text
        },
        error: function(xhr, textStatus, errorThrown) {
          console.error('Error marking topic as complete:', errorThrown);
        }
      });
    }
    
      </script>
      <!-- end make completed javascrpts -->
    

<script>


    $(document).ready(function () {
        $('#example').DataTable({
            pagingType: 'simple',
            dom: 'Qfrtip',
            ordering: false,
            bPaginate: true,
            scrollY: '100%',
            scrollCollapse: true,
            pageLength: 1,
            stateSave: true,
            dom: '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>'
        });
    });


    </script>    
<script>
    // Get the total number of topics from Django template variable
    var totalTopics = {{ topics|length }};

    // Get the pagination container
    var paginationContainer = document.getElementById('pagination-container');

    // Generate pagination links
    var paginationHTML = '';
    for (var i = 1; i <= Math.ceil(totalTopics / 10); i++) { // Assuming each page shows 10 topics
        paginationHTML += '<a href="?page=' + i + '">' + i + '</a>';
    }

    // Insert pagination links into the pagination container
    paginationContainer.innerHTML = paginationHTML;
</script>

<!-- iframe videos -->

<script>
    "use strict";
    if (document.readyState !== 'loading') init();
    else document.addEventListener('DOMContentLoaded', init);
    
    function init() {
        if (window.runOnce) return;
    
        if (typeof YT === 'undefined') {
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
    
        var iframes = [];
        
        for (var iframe of document.querySelectorAll("iframe[src]")) {
            var src = iframe.getAttribute("src");
            if (src.includes("youtube.com/embed/")) {
                if(!src.includes("enablejsapi=1"))
                    if(src.includes("?"))
                        iframe.setAttribute("src", src + "&enablejsapi=1");
                    else
                        iframe.setAttribute("src", src + "?enablejsapi=1");
    
                iframes.push(iframe);
            }
        }
    
        var overlayStyles = {
            display: "none",
            content:"",
            position: "absolute",
            left: 0,
            right: 0,
            cursor: "pointer",
            backgroundColor: "black",
            opacity:0,
            backgroundRepeat: "no-repeat",
            backgroundPosition: "center",
        };
    
        window.onYouTubeIframeAPIReady = function() {
            iframes.forEach(function(iframe) {
                var overlay = document.createElement('div');
                for (var style in overlayStyles) {
                    overlay.style[style] = overlayStyles[style];
                }
                
               // ...

                var wrapper = document.createElement('div');
                wrapper.style.display = "inline-block";
                wrapper.style.position = "relative";
                wrapper.style.marginLeft = "5px";
                wrapper.style.marginRight = "5px";

                // ...

               
              
    
                iframe.parentNode.insertBefore(wrapper, iframe);
                
                wrapper.appendChild(overlay);
                wrapper.appendChild(iframe);
                
                var onPlayerStateChange = function(event) {
                    if (event.data == YT.PlayerState.ENDED) {
                        overlay.style.backgroundImage = "url(data:image/svg+xml;utf8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwIDAgNTEwIDUxMCI+PHBhdGggZD0iTTI1NSAxMDJWMEwxMjcuNSAxMjcuNSAyNTUgMjU1VjE1M2M4NC4xNSAwIDE1MyA2OC44NSAxNTMgMTUzcy02OC44NSAxNTMtMTUzIDE1My0xNTMtNjguODUtMTUzLTE1M0g1MWMwIDExMi4yIDkxLjggMjA0IDIwNCAyMDRzMjA0LTkxLjggMjA0LTIwNC05MS44LTIwNC0yMDQtMjA0eiIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==)";
                       
                        overlay.style.backgroundSize = "64px 64px";
                        // overlay.style.top = 0;
                        // overlay.style.bottom = 0;
                        overlay.style.top = "60px";
                        overlay.style.bottom = "10px";
                        overlay.style.display = "inline-block";

                    } else if (event.data == YT.PlayerState.PAUSED) {
                        overlay.style.backgroundImage = "url(data:image/svg+xml;utf8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEiIHdpZHRoPSIxNzA2LjY2NyIgaGVpZ2h0PSIxNzA2LjY2NyIgdmlld0JveD0iMCAwIDEyODAgMTI4MCI+PHBhdGggZD0iTTE1Ny42MzUgMi45ODRMMTI2MC45NzkgNjQwIDE1Ny42MzUgMTI3Ny4wMTZ6IiBmaWxsPSIjZmZmIi8+PC9zdmc+)";
                        overlay.style.backgroundSize = "40px 40px";
                        overlay.style.top = "40px";
                        overlay.style.bottom = "50px";
                        overlay.style.display = "inline-block";
                    } else if (event.data == YT.PlayerState.PLAYING) {
                        overlay.style.display = "none";
                    }
                };
                
                var player  = new YT.Player(iframe, {
                        events: {
                            'onStateChange': onPlayerStateChange
                        }
                    });
            
                wrapper.addEventListener("click", function() {
                    var playerState = player.getPlayerState();
                    if (playerState == YT.PlayerState.ENDED) {
                        player.seekTo(0);
                    } else if (playerState == YT.PlayerState.PAUSED) {
                        player.playVideo();
                    }
                });
            });
        };
        window.runOnce = true;
    }
    

    // transcript viddo

    </script>
    


    <!-- link to the solution of related videos -->
    <!-- https://stackoverflow.com/questions/57820478/how-to-disable-related-videos-from-an-embedded-youtube-playlist -->
  {% endblock %} 
 
