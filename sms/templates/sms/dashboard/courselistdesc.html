{% extends 'sms/dashboard/base.html' %}
{% load hitcount_tags %}

{% block title %} Course Details {% endblock %}

{% block content %}  
<style>
  :root {
    --primary: #7890f9;
    --secondary: #5660ed;
    --accent: #151516;
    --light: #f8f9fa;
    --dark: #212529;
    --success: #4cc9f0;
    --warning: #f72585;
    --gray: #6c757d;
    --light-gray: #e9ecef;
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    --hover-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
  }
  
  .course-hero {
    background: rgb(244, 242, 240);
    color: rgb(16, 1, 1);
    padding: 2.5rem 1.5rem;
    border-radius: 0 0 20px 20px;
    margin-bottom: 2rem;
    box-shadow: var(--card-shadow);
  }
  
  .course-header {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .instructor-img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 15px;
    border: 3px solid rgba(255, 255, 255, 0.3);
  }
  
  .instructor-info {
    flex: 1;
  }
  
  .course-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }
  
  .enrollment-count {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.4rem 1rem;
    border-radius: 50px;
    font-size: 0.9rem;
    display: inline-block;
    margin-bottom: 1rem;
  }
  
  .pricing-badge {
    font-size: 1.4rem;
    font-weight: 700;
    margin: 1rem 0;
    padding: 0.6rem 1.2rem;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    display: inline-block;
  }
  
  .category-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    margin: 1.2rem 0;
  }
  
  .category-tag {
    background: rgba(255, 255, 255, 0.15);
    padding: 0.4rem 1rem;
    border-radius: 50px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
  }
  
  .category-tag i {
    margin-right: 0.5rem;
    font-size: 0.8rem;
  }
  
  .course-description {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    max-width: 800px;
  }
  
  .cta-container {
    margin: 2rem 0 1rem;
  }
  
  .btn-primary {
    background: var(--accent);
    border: none;
    padding: 0.8rem 2rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(114, 9, 183, 0.3);
  }
  
  .btn-primary:hover {
    background: #5a08a0;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(114, 9, 183, 0.4);
  }
  
  .section-card {
    background: white;
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    margin-bottom: 2rem;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .section-card:hover {
    box-shadow: var(--hover-shadow);
  }
  
  .section-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--light-gray);
    font-weight: 700;
    color: var(--dark);
    font-size: 1.4rem;
    display: flex;
    align-items: center;
  }
  
  .section-header i {
    margin-right: 0.8rem;
    color: var(--primary);
  }
  
  .section-body {
    padding: 1.5rem;
  }
  
  .read-more-toggle {
    color: var(--primary);
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    margin-top: 1rem;
  }
  
  .read-more-toggle i {
    margin-left: 0.5rem;
    transition: transform 0.3s ease;
  }
  
  .read-more-toggle[aria-expanded="true"] i {
    transform: rotate(180deg);
  }
  
  .prerequisites-list {
    list-style: none;
    padding: 0;
  }
  
  .prerequisites-list li {
    padding: 0.8rem 0;
    border-bottom: 1px solid var(--light-gray);
    display: flex;
    align-items: center;
  }
  
  .prerequisites-list li:last-child {
    border-bottom: none;
  }
  
  .prerequisites-list li i {
    color: var(--success);
    margin-right: 1rem;
  }
  
  .prerequisites-list a {
    color: var(--dark);
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .prerequisites-list a:hover {
    color: var(--primary);
  }
  
  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }
  
  .benefit-card {
    background: var(--light);
    border-radius: 10px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
  }
  
  .benefit-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--card-shadow);
  }
  
  .benefit-icon {
    background: var(--primary);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin-right: 1rem;
    flex-shrink: 0;
  }
  
  .learning-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }
  
  .learning-card {
    background: var(--light);
    border-radius: 10px;
    padding: 1.5rem;
    transition: all 0.3s ease;
  }
  
  .learning-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--card-shadow);
  }
  
  .learning-card-header {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: var(--primary);
    display: flex;
    align-items: center;
  }
  
  .learning-card-header i {
    margin-right: 0.8rem;
  }
  
  .learning-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1rem;
  }
  
  .learning-item i {
    color: var(--success);
    margin-right: 0.8rem;
    margin-top: 0.2rem;
    flex-shrink: 0;
  }
  
  .skill-badge {
    display: inline-block;
    background: rgba(67, 97, 238, 0.1);
    color: var(--primary);
    padding: 0.4rem 1rem;
    border-radius: 50px;
    margin: 0 0.5rem 0.5rem 0;
    font-size: 0.9rem;
  }
  
  .accordion-button {
    font-weight: 600;
    padding: 1.2rem 1.5rem;
    color: var(--dark);
  }
  
  .accordion-button:not(.collapsed) {
    background-color: rgba(67, 97, 238, 0.05);
    color: var(--primary);
  }
  
  .accordion-button::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%234361ee'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
  }
  
  .accordion-button:not(.collapsed)::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%234361ee'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
  }
  
  .review-card {
    border: none;
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
    overflow: hidden;
  }
  
  .review-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--hover-shadow);
  }
  
  .review-avatar {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    object-fit: cover;
    margin: 0 auto;
    border: 3px solid var(--light-gray);
  }
  
  .rating-stars {
    color: #ffc107;
    margin: 0.5rem 0;
  }
  
  .related-courses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }
  
  .related-course-card {
    border: none;
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
    overflow: hidden;
  }
  
  .related-course-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
  }
  
  .course-image {
    height: 160px;
    object-fit: cover;
  }
  
  .course-provider {
    display: flex;
    align-items: center;
    margin-bottom: 0.8rem;
  }
  
  .provider-logo {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 0.8rem;
  }
  
  .course-price {
    font-weight: 700;
    color: var(--primary);
  }
  
  .fixed-bottom-cta {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
  }
  
  .fixed-bottom-cta.show {
    transform: translateY(0);
  }
  
  .fixed-price {
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--primary);
  }
  
  .certificate-img {
    max-width: 100%;
    border-radius: 12px;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
    margin: 1.5rem 0;
  }
  
  @media (max-width: 768px) {
    .course-title {
      font-size: 1.8rem;
    }
    
    .benefits-grid,
    .learning-grid,
    .related-courses-grid {
      grid-template-columns: 1fr;
    }
    
    .fixed-bottom-cta {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }
    
    .header-container {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .instructor-info {
      margin-top: 1rem;
    }
  }
</style>

<div class="course-hero">
  <div class="course-header">
    {% if object.course_logo.url %}
      <img class="instructor-img" src="{{ object.course_logo.url }}" alt="Instructor"> 
    {% else %}
      <img class="instructor-img" src="/static/sms/images/newlogo3.jpg" alt="Codethinkers Academy">
    {% endif %}
    
    <div class="instructor-info">
      <h6 class="mb-0">{{ object.course_owner|default:"Codethinkers Academy"|safe }}</h6>
      <small>Course Instructor</small>
    </div>
  </div>
  
  <h1 class="course-title">{{ object.title|safe }}</h1>
  
  <div class="enrollment-count">
    <i class="fas fa-users mr-1"></i>
    {% get_hit_count for object as hit_count %}
    {{ hit_count|add:100 }}+ students enrolled
  </div>
  
  {% if school_name %}
    <div class="pricing-badge">Premium Course</div>
  {% else %}
    {% if object.status_type == 'Premium' %}
      <div class="pricing-badge">{{ object.status_type|safe }} | &#8358;{{ object.price|safe|floatformat:"0g" }}</div>
    {% else %}
      <div class="pricing-badge">{{ object.status_type|safe }}</div>
    {% endif %}
  {% endif %}
  
  <div class="category-tags">
    <span class="category-tag">
      <i class="fas fa-tag"></i> {{ object.categories.name|safe|title }} level
    </span>
    <span class="category-tag">
      <i class="fas fa-graduation-cap"></i> {{ object.course_type|safe }}
    </span>
  </div>
  
  <p class="course-description">{{ object.desc|truncatechars:300|safe }}</p>
  
  <div class="cta-container">
    {% if course.status_type == 'Free' %}
      <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
        <i class="fas fa-play-circle mr-2"></i>Start Learning
      </a>
    {% elif related_payments %}
      <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
        <i class="fas fa-play-circle mr-2"></i>Continue Learning
      </a>
    {% elif associated_schools %}
      {% for school in associated_schools %}
        {% if school.school_name == school_name %}
          <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
            <i class="fas fa-play-circle mr-2"></i>Start Learning
          </a>
        {% else %}
          <a href="{% url 'sms:course' course.id %}" class="btn btn-primary">
            <i class="fas fa-lock mr-2"></i>Enroll Now
          </a>
        {% endif %}
      {% endfor %}
    {% else %}
      <a href="{% url 'sms:course' course.id %}" class="btn btn-primary">
        <i class="fas fa-lock mr-2"></i>Enroll Now
      </a>
    {% endif %}
  </div>
</div>

<div class="container">
  <!-- About Course Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-info-circle"></i>About This Course
    </div>
    <div class="section-body">
      <p>{{ object.desc|linebreaksbr|truncatechars:200|safe }}</p>
      <div class="collapse" id="courseDescription">
        <p>{{ object.desc|linebreaksbr|safe }}</p>
      </div>
      <a data-toggle="collapse" href="#courseDescription" class="read-more-toggle" aria-expanded="false" aria-controls="courseDescription">
        <span class="collapsed">Show more</span>
        <span class="expanded">Show less</span>
        <i class="fas fa-chevron-down"></i>
      </a>
    </div>
  </div>

  <!-- Prerequisites Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-clipboard-list"></i>Course Prerequisites
    </div>
    <div class="section-body">
      {% if prerequisites %}
        <ul class="prerequisites-list">
          {% for prerequisite in prerequisites %}
            <li>
              <i class="fas fa-check-circle"></i>
              <a href="{% url 'sms:courseslistdesc' prerequisite.id %}">{{ prerequisite.title }}</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No prerequisites for this course.</p>
      {% endif %}
    </div>
  </div>

  <!-- Benefits Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-star"></i>Course Benefits
    </div>
    <div class="section-body">
      <div class="benefits-grid">
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-laptop"></i></div>
          <div>100% online courses</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-calendar-alt"></i></div>
          <div>Flexible deadlines</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-users"></i></div>
          <div>Collaborative learning</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-briefcase"></i></div>
          <div>Career opportunities</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-certificate"></i></div>
          <div>Certificate of completion</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon"><i class="fas fa-globe"></i></div>
          <div>English language</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Instructor Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-user-tie"></i>About the Instructor
    </div>
    <div class="section-body">
      <div class="d-flex align-items-center mb-4">
        {% if object.course_logo.url %}
          <img class="instructor-img" src="{{ object.course_logo.url }}" alt="Instructor"> 
        {% else %}
          <img class="instructor-img" src="/static/sms/images/newlogo3.jpg" alt="Codethinkers Academy">
        {% endif %}
        <div class="ml-3">
          <h5 class="mb-0">{{ object.course_owner|default:"Codethinkers Academy"|safe }}</h5>
          <p class="text-muted mb-0">Course Instructor</p>
        </div>
      </div>
      
      {% if aboutcourseowners %}
        {% for aboutcourseowner in aboutcourseowners %}
          <p>{{ aboutcourseowner.desc|linebreaksbr|truncatechars:200|safe }}</p>
          <div class="collapse" id="instructorBio">
            <p>{{ aboutcourseowner.desc|linebreaksbr|safe }}</p>
          </div>
          <a data-toggle="collapse" href="#instructorBio" class="read-more-toggle" aria-expanded="false" aria-controls="instructorBio">
            <span class="collapsed">Read more</span>
            <span class="expanded">Show less</span>
            <i class="fas fa-chevron-down"></i>
          </a>
        {% empty %}
          <p class="text-muted">No information available about the instructor.</p>
        {% endfor %}
      {% else %}
        <p>Welcome to CodeThinkers Academy, your gateway to the exciting world of coding and technology! At CodeThinkers Academy, we empower you to unlock endless opportunities in the tech industry.</p>
        <div class="collapse" id="instructorBio">
          <p>Why CodeThinkers Academy? Unlock Endless Opportunities: In today's tech-driven world, coding skills are more valuable than ever. At CodeThinkers Academy, we empower you to unlock endless opportunities in the tech industry, from web development to app creation and beyond. Expert Instructors: Learn from the best! Our team of experienced and passionate instructors will guide you through every step of your coding journey. They are dedicated to your success and will ensure you grasp complex concepts with ease. Hands-on Learning: At CodeThinkers Academy, we believe in learning by doing. Our curriculum is designed to offer hands-on projects and real-world scenarios, giving you the confidence to tackle any coding challenge.</p>
        </div>
        <a data-toggle="collapse" href="#instructorBio" class="read-more-toggle" aria-expanded="false" aria-controls="instructorBio">
          <span class="collapsed">Read more</span>
          <span class="expanded">Show less</span>
          <i class="fas fa-chevron-down"></i>
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Learning Objectives Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-bullseye"></i>What You'll Learn
    </div>
    <div class="section-body">
      <div class="learning-grid">
        <div class="learning-card">
          <div class="learning-card-header">
            <i class="fas fa-brain"></i>Knowledge
          </div>
          {% for obj in whatyouwilllearn %}
            <div class="learning-item">
              <i class="fas fa-check text-success"></i>
              <div>{{ obj.desc|safe }}</div>
            </div>
          {% empty %}
            <p class="text-muted">No learning objectives defined yet.</p>
          {% endfor %}
        </div>
        
        <div class="learning-card">
          <div class="learning-card-header">
            <i class="fas fa-tools"></i>Skills
          </div>
          {% for category in skillyouwillgain %}
            <div class="learning-item">
              <i class="fas fa-check text-success"></i>
              <div>{{ category.title|safe }}</div>
            </div>
          {% empty %}
            <p class="text-muted">No skills information available.</p>
          {% endfor %}
        </div>
        
        <div class="learning-card">
          <div class="learning-card-header">
            <i class="fas fa-project-diagram"></i>Projects
          </div>
          {% for category in whatyouwillbuild %}
            <div class="learning-item">
              <i class="fas fa-check text-success"></i>
              <div>{{ category.desc|safe }}</div>
            </div>
          {% empty %}
            <p class="text-muted">No project information available.</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- FAQ Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-question-circle"></i>Frequently Asked Questions
    </div>
    <div class="section-body">
      <div class="accordion" id="faqAccordion">
        {% for faq in faqs %}
          <div class="card mb-2">
            <div class="card-header p-0" id="faqHeading{{ faq.id }}">
              <h2 class="mb-0">
                <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#faqCollapse{{ faq.id }}" aria-expanded="false" aria-controls="faqCollapse{{ faq.id }}">
                  {{ faq.title|safe }}
                </button>
              </h2>
            </div>
            <div id="faqCollapse{{ faq.id }}" class="collapse" aria-labelledby="faqHeading{{ faq.id }}" data-parent="#faqAccordion">
              <div class="card-body">
                {{ faq.desc|safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Career Opportunities Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-briefcase"></i>Career Opportunities
    </div>
    <div class="section-body">
      <div class="accordion" id="careerAccordion">
        {% for obj in careeropportunities %}
          <div class="card mb-2">
            <div class="card-header p-0" id="careerHeading{{ forloop.counter }}">
              <h2 class="mb-0">
                <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#careerCollapse{{ forloop.counter }}" aria-expanded="false" aria-controls="careerCollapse{{ forloop.counter }}">
                  {{ obj.courses|safe }}
                </button>
              </h2>
            </div>
            <div id="careerCollapse{{ forloop.counter }}" class="collapse" aria-labelledby="careerHeading{{ forloop.counter }}" data-parent="#careerAccordion">
              <div class="card-body">
                {{ obj.desc|safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Certificate Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-award"></i>Shareable Certificate
    </div>
    <div class="section-body text-center">
      <img src="https://iili.io/dwR2F3b.png" class="certificate-img" alt="Certificate">
      <p>You can share your Certificate with friends and family, on printed resumes, CVs, or other important documents.</p>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-star"></i>Learners' Reviews
    </div>
    <div class="section-body">
      <div class="row">
        {% for obj in courseLearnerReviews %}
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="review-card card h-100">
              <div class="card-body text-center">
                <img src="/static/sms/images/blankavater.png" class="review-avatar mb-3" />
                <h6>{{ obj.title }}</h6>
                <div class="rating-stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star-half-alt"></i>
                </div>
                <p class="card-text mt-3">"{{ obj.desc }}"</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Related Courses Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-book"></i>Related Courses
    </div>
    <div class="section-body">
      <div class="related-courses-grid">
        {% for obj in related_courses %}
          <div class="related-course-card card">
            {% if obj.img_course %}
              <img src="{{ obj.img_course.url }}" class="course-image card-img-top" alt="Course image">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ obj.title }}</h5>
              
              <div class="course-provider">
                {% if obj.course_logo.url %}
                  <img src="{{ obj.course_logo.url }}" class="provider-logo" alt="Provider logo">
                {% else %}
                  <img src="/static/sms/images/newlogo3.jpg" class="provider-logo" alt="Codethinkers Academy">
                {% endif %}
                <small>{{ object.course_owner|default:"Codethinkers Academy"|safe }}</small>
              </div>
              
              {% if obj.status_type == 'Premium' %}
                <div class="course-price">{{ obj.status_type|safe }} | &#8358;{{ obj.price|safe }}</div>
              {% else %}
                <div class="course-price text-success">{{ obj.status_type|safe }}</div>
              {% endif %}
              
              <div class="d-flex flex-wrap mt-3">
                <span class="skill-badge">{{ obj.categories.name|safe|title }}</span>
                <span class="skill-badge">{{ obj.course_type|safe }}</span>
              </div>
              
              <a href="{% url 'sms:courseslistdesc' obj.pk %}" class="btn btn-outline-primary btn-block mt-3">View Course</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- Fixed Bottom CTA -->
<div class="fixed-bottom-cta" id="fixedCta">
  <div>
    <h5 class="mb-0">{{ object.title|safe }}</h5>
    {% if object.status_type == 'Premium' %}
      <div class="fixed-price">&#8358;{{ object.price|safe|floatformat:"0g" }}</div>
    {% else %}
      <div class="fixed-price">Free</div>
    {% endif %}
  </div>
  <div>
    {% if course.status_type == 'Free' %}
      <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
        Start Learning
      </a>
    {% elif related_payments %}
      <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
        Continue Learning
      </a>
    {% elif associated_schools %}
      {% for school in associated_schools %}
        {% if school.school_name == school_name %}
          <a href="{% url 'sms:topicslistview' course.id %}" class="btn btn-primary">
            Start Learning
          </a>
        {% else %}
          <a href="{% url 'sms:course' course.id %}" class="btn btn-primary">
            Enroll Now
          </a>
        {% endif %}
      {% endfor %}
    {% else %}
      <a href="{% url 'sms:course' course.id %}" class="btn btn-primary">
        Enroll Now
      </a>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Show/hide fixed CTA based on scroll position
    window.addEventListener("scroll", function() {
      var cta = document.getElementById("fixedCta");
      if (window.pageYOffset > 300) {
        cta.classList.add("show");
      } else {
        cta.classList.remove("show");
      }
    });
  });
</script>

{% if related_payments.exists and not payment_success %}
  <input type="hidden" id="paymentSuccess" value="true">
{% endif %}

<script>
  // Check if the payment success flag is present
  var paymentSuccessInput = document.getElementById('paymentSuccess');
  if (paymentSuccessInput && paymentSuccessInput.value === 'true') {
    // Check if the payment_success session storage is set
    var paymentSuccessStorage = sessionStorage.getItem('payment_success');
    if (!paymentSuccessStorage || paymentSuccessStorage === 'true') {
      // Set the payment_success session storage to false and reload the page after 1 second
      sessionStorage.setItem('payment_success', 'false');
      console.log('Page reloading - 1st time');
      setTimeout(function() {
        console.log('Page reloaded - 1st time');
        window.location.reload();
      }, 1000);
    } else if (paymentSuccessStorage === 'false') {
      // Set the payment_success session storage back to true and reload the page again after 5 seconds
      sessionStorage.setItem('payment_success', 'true');
      console.log('Page reloading - 2nd time');
      setTimeout(function() {
        console.log('Page reloaded - 2nd time');
        window.location.reload();
      }, 300000);
    }
  }
</script>

{% endblock %}